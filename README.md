# hackaton

Простой пример Telegram-бота на Go.

Функциональность

- При запуске бот показывает клавиатуру с опциями: регистрация, смена привязанного кошелька, получить ссылку на чат.
- При регистрации пользователь отправляет адрес TON-кошелька. Бот проверяет баланс через внешний REST API (по умолчанию https://tonapi.io/v2/accounts/).
- Если баланс > 0 — бот считает пользователя допустимым и отправляет ссылку-приглашение в чат. Если баланса нет — бот отвечает, что баланс пуст или NFT отсутствуют.

Короткая инструкция по запуску

1. Установите Go (1.20+ рекомендуется).
2. Установите переменные окружения (пример):

```bash
export token="<YOUR_TELEGRAM_BOT_TOKEN>"
export invlink="https://t.me/joinchat/...."   # ссылка-приглашение в ваш чат
# опционально: адрес REST API для проверки баланса
export tonaddr="https://tonapi.io/v2/accounts/"
# опционально: время проверки в секундах для воркера
export checktime=120
```

3. Запустите бота (в директории проекта):

```bash
go run ./app
```

Или постройте бинарник и запустите:

```bash
go build ./...
./hackaton
```

Тесты

- В проекте есть unit-тесты для слоя сервиса (файл `services/service_test.go`). Запустить всё:

```bash
go test ./...
```

Что сделано дополнительно

- Простая реализация REST-клиента с устойчивой обработкой JSON.
- Добавлено логирование старта и основных ошибок (в `app/main.go`).
- Бот отвечает на CallbackQuery, чтобы в клиенте сразу убрать индикатор загрузки.
- Добавлены юнит-тесты для сервиса с мок-реализацией REST.

Архитектура — кратко

- `app/` — точка входа, обработка апдейтов Telegram и маршрутизация состояний диалога.
- `handlers/` — генерация ответных сообщений (callback handlers).
- `services/` — бизнес-логика (регистрация, проверка банов, работа с репозиториями).
- `repositories/` — простые in-memory репозитории для пользователей и чатов.
- `transport/` — REST-клиент для запроса баланса.

Замечания и дальнейшие улучшения

- Текущий парсинг ответа REST делает допущения про поле `balance`; рекомендую подогнать структуру под конкретный API (использовать заранее описанные struct'ы).
- Вместо отправки invite-link можно автоматически добавлять в группу (требуется права бота и соответствующая логика).
- Добавить валидацию формата адреса кошелька перед запросом к внешнему API.
- Подключить структурированный логгер (zap/logrus) и более точную обработку ошибок.

Контакты и вклад
PR и issues приветствуются.
